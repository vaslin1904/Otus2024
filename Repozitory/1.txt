- name: Build brotli
  ansible.builtin.command: cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF -DCMAKE_C_FLAGS="-Ofast -m64 -march=native -mtune=native -flto -funroll-loops -ffunction-sections -fdata-sections -Wl,--gc-sections" -DCMAKE_CXX_FLAGS="-Ofast -m64 -march=native -mtune=native -flto -funroll-loops -ffunction-sections -fdata-sections -Wl,--gc-sections" -DCMAKE_INSTALL_PREFIX=./installed ..
  args:
    chdir: /home/vagrant/nginx-*/debian/modules/ngx_brotli/out

- name: Build brotli encoder
  ansible.builtin.command: cmake --build . --config Release --target brotlienc
  args:
    chdir: /home/vagrant/nginx-*/debian/modules/ngx_brotli/out
Изменения и пояснения:
Использование модуля git: Это позволяет легко клонировать репозитории.
Создание каталога: Папка out создается с отдельным заданием.
Рабочий каталог chdir: Каждая командa имеет чистый chdir, чтобы правильно настраивать рабочую среду.
Убедитесь, что путь к nginx-* корректен и соответствует тому, как у вас организованы файлы. Настройте его по мере необходимости.
