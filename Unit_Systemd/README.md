# **Systemd**
___________________________________________
## **Создание сервиса мониторинга**
___________________________________________
1. Размещаем конфиг watchlog в директорию /etc/default со значением переменных:
   - $WORD - устанавливается слова для поиска. В данной работе "Alert"
   - $LOG - полное имя лога, в котором будет произодиться поиск (/var/log/watchlog.log).
2. Размещаем watchlog.log в директорию /var/log.
3. Размещаем скрипт [watchlog.sh](ansible/roles/my_service/files/opt/watchlog.sh) в директорию /opt, который при нахождении эталонного слова в заданном логе
с помощью команды logger помещает сообщение в системный лог.
4. Создаем
2. Проверим работу системы мониторинга:<br>
**tail -f /var/log/messages**<br>
![Мониторинг файла](картинки/6.png)<br>
_____________________________________________________________________
## **Переписать init-скрипт на unit-файл**
_____________________________________________________________________
1. Устанавливаем spawn-fcgi и необходимые для него пакеты:<br>
**yum install epel-release -y && yum install spawn-fcgi php php-cli mod_fcgid httpd -y**
2. В файле /etc/sysconfig/spawn-fcgi раскомментируем строку "OPTIONS".<br>
![Файл spawn-fcgi](картинки/7.png)<br>
3. Создаем юнит: **vi /etc/systemd/system/spawn-fcgi.service**<br>.
см. файл spawn-fcgi.service. <br>
4. Запускаем созданный сервис. <br>
![Запуск spawn-fcgi.service](картинки/8.png)<br>
______________________________________________
## **Одновременный запуск сервиса httpd с разными конфигами**
______________________________________________
1. Найдем местоположение файла httpd.service.<br>
![Статус httpd.service](картинки/10.png)<br>

2. Скопируем httpd.service как шаблон в каталог /etc/systemd/system:<br>
**cp /usr/lib/systemd/system/httpd.service /etc/systemd/system/httpd@.service**<br>
![Создание шаблона сервиса httpd](картинки/12.png)

3.  Добавим имя экземпляра  в шаблоне %I:<br>
 **vi /etc/systemd/system/httpd\@.service**<br>
 ![Изменение шаблона](картинки/13.png)

4.  Создаем два файла окружения в директории, копируя файл /etc/sysconfig/httpd:httpd-first и httpd-second:<br>
![Добавление 2-х файлов окружения](картинки/14.png)

5. В файлазх окружения задаетсā опция для запуска веб-сервера с необходимым конфигурационным файлом.<br> 
![Добавление опции](картинки/15.png)<br>

6. Переходим в директорию с конфигами httpd: /etc/httpd/cong/.<br>
Копируем оригинальный конфиг httpd.conf под именами  first.conf и second.conf. <br>
Внесем изменения только в second.conf. <br>
Добавим строчку PidFile /var/run/httpd-second.pid и Изменим порт для прослушивания на 8080 : Listen 8080. <br>
![Добавление опции](картинки/16.png)<br>
7. Запустим сервис httpd с разными конфигурационными файлами:<br>
![first.config](картинки/17.png)<br>
![second.config](картинки/18.png)<br>
____________________________________________
## **Вывод**
В данной работе рассмотрели создание юнитов systemd, их запуска. Рассмотрели способ одновременного запуска сервиса с разными конфигурационными файлами.
_____________________________________________
Файл Vagrant подзагружает box из облака, в котором уже есть сервис мониторинга. его только нужно запустить.
Настроен httpd сервис для запуска с разными конфигурациями.

